<!-- src/app/components/analytics/analytics.component.html -->
<div class="analytics-container">
  <!-- Header -->
  <div class="analytics-header">
    <div class="header-content">
      <h1>
        <mat-icon>analytics</mat-icon>
        Employee Analytics
      </h1>
      <p>
        Comprehensive insights into your workforce and organizational structure
      </p>
    </div>
    <div class="header-actions">
      <button
        mat-raised-button
        color="primary"
        (click)="refreshAnalytics()"
        [disabled]="loading"
      >
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
      <button
        mat-raised-button
        color="accent"
        (click)="exportAnalyticsReport()"
      >
        <mat-icon>download</mat-icon>
        Export Report
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading analytics data...</p>
  </div>

  <!-- Analytics Content -->
  <div *ngIf="!loading" class="analytics-content">
    <!-- Key Metrics -->
    <div class="metrics-grid">
      <mat-card class="metric-card">
        <mat-card-content>
          <div class="metric-icon total-employees">
            <mat-icon>groups</mat-icon>
          </div>
          <div class="metric-info">
            <h3>{{ analytics.totalEmployees }}</h3>
            <p>Total Employees</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="metric-card">
        <mat-card-content>
          <div class="metric-icon departments">
            <mat-icon>business</mat-icon>
          </div>
          <div class="metric-info">
            <h3>{{ analytics.totalDepartments }}</h3>
            <p>Departments</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="metric-card">
        <mat-card-content>
          <div class="metric-icon salary">
            <mat-icon>attach_money</mat-icon>
          </div>
          <div class="metric-info">
            <h3>${{ analytics.averageSalary | number : "1.0-0" }}</h3>
            <p>Average Salary</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="metric-card">
        <mat-card-content>
          <div class="metric-icon hires">
            <mat-icon>person_add</mat-icon>
          </div>
          <div class="metric-info">
            <h3>{{ analytics.recentHires }}</h3>
            <p>Recent Hires (30 days)</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Section -->
    <div class="charts-grid">
      <!-- Department Distribution -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>pie_chart</mat-icon>
            Department Distribution
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="departmentChartData"
              [type]="'pie'"
              [options]="chartOptions"
            >
            </canvas>
          </div>
          <div class="chart-legend">
            <div
              *ngFor="let dept of analytics.departmentStats"
              class="legend-item"
            >
              <span
                class="legend-color"
                [style.background]="getChartColor(dept.name)"
              ></span>
              <span class="legend-label">{{ dept.name }}</span>
              <span class="legend-value"
                >{{ dept.count }} ({{
                  dept.percentage | number : "1.1-1"
                }}%)</span
              >
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Salary Analysis -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>bar_chart</mat-icon>
            Average Salary by Department
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="salaryChartData"
              [type]="'bar'"
              [options]="salaryChartOptions"
            >
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Position Distribution -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>show_chart</mat-icon>
            Top Positions
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="positionChartData"
              [type]="'bar'"
              [options]="chartOptions"
            >
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Salary Distribution -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>account_balance_wallet</mat-icon>
            Salary Distribution
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="distribution-list">
            <div
              *ngFor="let range of analytics.salaryDistribution"
              class="distribution-item"
            >
              <div class="distribution-range">{{ range.range }}</div>
              <div class="distribution-bar">
                <div
                  class="distribution-fill"
                  [style.width]="
                    (range.count / analytics.totalEmployees) * 100 + '%'
                  "
                ></div>
              </div>
              <div class="distribution-count">{{ range.count }} employees</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Detailed Statistics -->
    <div class="stats-section">
      <mat-card class="stats-card">
        <mat-card-header>
          <mat-card-title>Department Details</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table class="stats-table">
            <thead>
              <tr>
                <th>Department</th>
                <th>Employees</th>
                <th>Percentage</th>
                <th>Avg Salary</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let dept of analytics.departmentStats">
                <td>{{ dept.name }}</td>
                <td>{{ dept.count }}</td>
                <td>{{ dept.percentage | number : "1.1-1" }}%</td>
                <td>
                  ${{
                    getDepartmentAverageSalary(dept.name) | number : "1.0-0"
                  }}
                </td>
              </tr>
            </tbody>
          </table>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
